<!DOCTYPE html>
<html lang="en">
    <head>
        <meta http-equiv="content-type" content="text/html; charset=UTF-8">
        <meta charset="utf-8">
        <meta name="generator" content="Bootply" />
        <meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1">
        <title>Lamar - Best Practices</title>
        <link href="/lamar/content/bootstrap.min.css" rel="stylesheet" type="text/css" />
        <link href="/lamar/content/prism.css" rel="stylesheet" type="text/css" />
        <link href="/lamar/content/theme.css" rel="stylesheet" type="text/css" />

        <link rel="apple-touch-icon" href="/bootstrap/img/apple-touch-icon.png">
        <link rel="apple-touch-icon" sizes="72x72" href="/bootstrap/img/apple-touch-icon-72x72.png">
        <link rel="apple-touch-icon" sizes="114x114" href="/bootstrap/img/apple-touch-icon-114x114.png">

        <link href="/lamar/content/affix.css" rel="stylesheet" type="text/css" />
    </head>

    <body>

      <a href="https://github.com/jasperfx/Lamar"><img style="z-index: 5000; position: absolute; top: 0; right: 0; border: 0;" src="https://camo.githubusercontent.com/e7bbb0521b397edbd5fe43e7f760759336b5e05f/68747470733a2f2f73332e616d617a6f6e6177732e636f6d2f6769746875622f726962626f6e732f666f726b6d655f72696768745f677265656e5f3030373230302e706e67" alt="Fork me on GitHub" data-canonical-src="https://s3.amazonaws.com/github/ribbons/forkme_right_green_007200.png"></a>

      <nav class="navbar navbar-default navbar-fixed-top" role="banner">
      <div class="container">
        <div class="navbar-header">
          <a href="/lamar" class="navbar-brand">Lamar</a>
        </div>
        <nav class="collapse navbar-collapse" role="navigation">
          <ul class="nav navbar-nav pull-right">
            <li>
              <a href="/lamar/getting_started">Getting Started</a>
            </li>
            <li>
              <a href="/lamar/documentation">Documentation</a>
            </li>
            <li>
              <a href="https://gitter.im/jasperfx/Lamar?utm_source=badge&amp;utm_medium=badge&amp;utm_campaign=pr-badge&amp;utm_content=badge"><img src="https://camo.githubusercontent.com/da2edb525cde1455a622c58c0effc3a90b9a181c/68747470733a2f2f6261646765732e6769747465722e696d2f4a6f696e253230436861742e737667" alt="Join the chat at https://gitter.im/jasperfx/Lamar" data-canonical-src="https://badges.gitter.im/Join%20Chat.svg" style="max-width:100%;"></a>
            </li>
            <li><a href="/lamar/documentation/ioc/diagnostics" title="Diagnostics">Previous</a></li>
            <li><a href="/lamar/documentation/ioc/auto-wiring" title="Auto Wiring">Next</a></li>
          </ul>
          <div class="navbar-form navbar-left" role="search">
            <div class="form-group">
              <input id="search" type="search" class="form-control" placeholder="Search">
            </div>
          </div>

        </nav>

      </div>
    </nav>

    <div class="container">
      <nav class="navbar-inverse">
        <ol class="breadcrumb"><li><a href="/lamar/">Lamar</a></li><li><a href="/lamar/documentation">Documentation</a></li><li><a href="/lamar/documentation/ioc">Lamar as IoC Container</a></li><li class="active">Best Practices</li></ol>
      </nav>
    </div>

    <!--main-->
    <div class="container">
      <div class="row">
          <!--left-->
          <div class="col-md-3" id="leftCol">
            <h3>Lamar 0.9.10</h3>
            <br />

            <ul class="nav nav-stacked affix" id="sidebar">
            </ul>

            <h3 class="no-margin">Next</h3><p><a href="/lamar/documentation/ioc/auto-wiring">Auto Wiring</a></p>
            <h3 class="no-margin">Previous</h3><a href="/lamar/documentation/ioc/diagnostics">Diagnostics</a></p>
          </div><!--/left-->

          <!--right-->
          <div class="col-md-9">
              <h1>Best Practices</h1>

              <hr />

              <div id="main-pane">
                <!--Title: Best Practices-->
<!--Url: best-practices-->
<p>All of these recommendations are the opinions and sole responsiblity of one <a href="http://jeremydmiller.com">Jeremy D. Miller</a>. The single best advice I can give you
about using StructureMap is to avoid being too clever with your usage.</p>
<h2 id="use-nested-containers-for-per-transactionrequestmessage-scoping">Use Nested Containers for Per Transaction/Request/Message Scoping</h2>
<p>In idiomatic StructureMap usage, I strongly recommend using a <p class="bg-warning" style="padding:5px"><b>Unknown topic key 'the-container/nested-containers'</b><small> -- CTRL+SHIFT+R to force refresh the topic tree</small></p> for short lived operations like:</p>
<ol>
<li>An HTTP request</li>
<li>Handling a single service bus message</li>
<li>Short lived transactions</li>
</ol>
<h2 id="avoid-the-legacy-asp.net-lifecycles">Avoid the Legacy ASP.Net Lifecycles</h2>
<p>To repeat the section above, I strongly recommend using nested containers instead of the legacy ASP.Net lifecycles to scope
services per HTTP request.</p>
<h2 id="avoid-container.configure-on-the-root-container">Avoid Container.Configure() on the Root Container</h2>
<p>Unfortunately, the <code>&lt;p class=&quot;bg-warning&quot; style=&quot;padding:5px&quot;&gt;&lt;b&gt;Unknown topic key &amp;#x27;registration/changing-configuration-at-runtime&amp;#x27;&lt;/b&gt;&lt;small&gt; -- CTRL&amp;#x2B;SHIFT&amp;#x2B;R to force refresh the topic tree&lt;/small&gt;&lt;/p&gt;</code> method is potentially an expensive operation
and can result in some container-wide locks if you change any kind of interception or construction policy. Avoid this mechanism at runtime. If you need
to inject services at runtime, try to do those overrides in an isolated <p class="bg-warning" style="padding:5px"><b>Unknown topic key 'the-container/nested-containers'</b><small> -- CTRL+SHIFT+R to force refresh the topic tree</small></p> for that
particular request or transaction to avoid hitting any kind of shared lock.</p>
<h2 id="avoid-container.trygetinstance">Avoid <code>Container.TryGetInstance()</code></h2>
<p>Use the container to resolve your dependency relationships or don't. In my opinion, using <code>TryGetInstance()</code> results in unnecessary complexity in your application. My recommendation is to use <em><a href="https://en.wikipedia.org/wiki/Null_Object_pattern">nullo objects</a></em> as stand-ins or to use &quot;modular registration&quot; strategies instead (See <p class="bg-warning" style="padding:5px"><b>Unknown topic key 'registration/fallback-services'</b><small> -- CTRL+SHIFT+R to force refresh the topic tree</small></p> and <p class="bg-warning" style="padding:5px"><b>Unknown topic key 'registration/clear-or-replace'</b><small> -- CTRL+SHIFT+R to force refresh the topic tree</small></p> for more information). The ASP.Net team requires this usage for all of their IoC container integrations and you can't fight city hall, so StructureMap 4.0 includes some performance optimizations specifically for the heavy <code>TryGetInstance()</code> usage that I never anticipated.</p>
<h2 id="favor-constructor-injection-over-setter-injection">Favor Constructor Injection over Setter Injection</h2>
<p>I believe that constructor injection is less error prone than setter injection and is more easily traceable later. Setter injection is occasionally easier
to use (in inheritance relationships for an example), but is mostly available in StructureMap as a workaround for code that was not built with dependency
injection in mind (or popular frameworks that were built around Spring.Net usage <em>cough</em> NServiceBus <em>cough</em>).</p>
<h2 id="use-child-containers-for-test-isolation">Use Child Containers for Test Isolation</h2>
<p>See <p class="bg-warning" style="padding:5px"><b>Unknown topic key 'the-container/profiles-and-child-containers'</b><small> -- CTRL+SHIFT+R to force refresh the topic tree</small></p> for more information.</p>
<h2 id="use-registry-classes">Use Registry Classes</h2>
<p>While you can completely set up a <code>Container</code> object through its constructor function and repeated calls to <code>Container.Configure()</code>, we suggest that you
express any configurations in <p class="bg-warning" style="padding:5px"><b>Unknown topic key 'registration'</b><small> -- CTRL+SHIFT+R to force refresh the topic tree</small></p> for repeatable configuration later in tests and for a cleaner expression
of the configuration.</p>
<p>Do consider breaking your configuration across separate <code>Registry</code> objects for different subsystems if the StructureMap configuration gets complicated.</p>
<h2 id="onion-architecture-assembly-coupling">Onion Architecture Assembly Coupling</h2>
<p>If your choice is between making a direct dependency from one assembly to another strictly to make the StructureMap configuration easy and less error prone or using dynamic assembly loading and configuration strategies with type scanning to comply with the <em>Onion Architecture</em>, <strong>I very strongly recommend you favor the less error prone, direct assembly dependencies</strong>.</p>
<h2 id="favor-build-policies-over-fancy-runtime-decision-making">Favor Build Policies over Fancy Runtime Decision Making</h2>
<p>While there are many powerful things you can do with StructureMap at runtime for conditional object resolution with <p class="bg-warning" style="padding:5px"><b>Unknown topic key 'the-container/working-with-the-icontext-at-build-time'</b><small> -- CTRL+SHIFT+R to force refresh the topic tree</small></p>,
I recommend trying to &quot;bake in&quot; building decisions upfront with <p class="bg-warning" style="padding:5px"><b>Unknown topic key 'registration/policies'</b><small> -- CTRL+SHIFT+R to force refresh the topic tree</small></p> for more efficient object resolution and so that
the container behavior is surfaced through diagnostics like the <p class="bg-warning" style="padding:5px"><b>Unknown topic key 'diagnostics/build-plans'</b><small> -- CTRL+SHIFT+R to force refresh the topic tree</small></p>.</p>

              </div>

              <hr />

              <nav>
                <span>
                  <strong>Previous: </strong><a href="/lamar/documentation/ioc/diagnostics">Diagnostics</a>

                </span>
                <span class="pull-right">

                  <strong>Next: </strong><a href="/lamar/documentation/ioc/auto-wiring">Auto Wiring</a>

                </span>
              </nav>

          </div><!--/right-->
        </div><!--/row-->
      </div><!--/container-->

    </body>


    <footer>
        <script type='text/javascript' src="http://ajax.googleapis.com/ajax/libs/jquery/1.9.1/jquery.min.js"></script>
        <script type='text/javascript' src="http://netdna.bootstrapcdn.com/bootstrap/3.1.1/js/bootstrap.min.js"></script>

        <script type="text/javascript" src="/lamar/content/prism.js"></script>
        <script type="text/javascript" src="/lamar/content/sidebar.js"></script>
        <script type="text/javascript" src="/lamar/content/affix.js"></script>

<script>
$('#search').keyup(function(e){
  if(e.keyCode == 13) {
    var search = $('#search').val();

    var url = 'https://www.google.com/#q=site:jasperfx.github.io ' + search;
    url = encodeURI(url);

    window.location.href = url;

    e.stopPropagation();
    if (e.cancelBubble!=null) e.cancelBubble = true;
    return false;
  }
});
</script>
    </footer>
</html>
